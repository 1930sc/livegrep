genrule(
  name = "cmake",
  srcs = [ "CMakeLists.txt" ],
  outs = [
    "build/include/divsufsort.h",
    "build/include/config.h",
    "build/include/lfs.h",
  ],
  local = 1,
  cmd = '''
  src=$$(python -c 'import os.path,sys; print os.path.realpath(os.path.dirname(sys.argv[1]))' $<)
  mkdir -p $(@D)/build && cd $(@D)/build
  cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF $$src
  '''
)

cc_library(
  name = "divsufsort",
  includes = [
    "build/include/",
    "include/",
  ],
  hdrs = [ ":cmake" ],
  srcs = glob(["lib/*.c", "include/*.h"]),
  visibility = [ "//visibility:public" ],
  copts = [
    "-DHAVE_CONFIG_H"
  ],
)
